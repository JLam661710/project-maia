# 分发与部署指南：AI驱动全自动化选题决策系统

## 部署架构
系统采用**“低代码平台托管核心流程+轻量云服务托管后台”**的混合部署方案，适配用户的AI技术背景与自动化需求：
1. **核心业务流程**：爬虫、数据处理、AI决策、推送全流程部署在扣子工作流平台，利用其可视化编排能力降低维护成本
2. **后台管理界面**：Streamlit仪表盘部署在阿里云ECS（1核2G基础版），通过公网IP访问
3. **数据存储**：核心数据存储在极致了数据平台，本地缓存使用SQLite存储在ECS服务器

## 部署步骤
### 1. 扣子工作流部署（核心流程）
1. 登录扣子工作流平台，创建新工作流“选题决策自动化流程”
2. 拖拽“爬虫插件”节点，配置小红书、B站、微信公众号爬取规则，设置重试次数（3次）与自动切换条件（失败3次后切换至Scrapy节点）
3. 拖拽“Python脚本”节点，上传数据处理ETL脚本（实现数据清洗、热点识别、受众标签提取）
4. 拖拽“大模型调用”节点，配置GPT-4o API密钥与prompt模板（生成选题建议的约束条件）
5. 拖拽“消息推送”节点，配置飞书机器人、微信公众号模板消息的API参数
6. 设置工作流触发规则：每日按用户预设时间（如早8点）自动启动

### 2. 后台仪表盘部署（Streamlit）
1. 在阿里云ECS服务器安装Python 3.10+、Streamlit依赖
2. 上传Streamlit仪表盘代码（包含可视化组件、数据查询接口）
3. 配置Nginx反向代理，将Streamlit服务（默认端口8501）映射至公网域名/IP
4. 设置防火墙规则，仅允许用户IP访问后台界面，提升安全性

### 3. 数据存储配置
1. 登录极致了数据平台，创建新数据集“选题决策系统数据”，配置数据同步规则（从扣子工作流接收结构化数据）
2. 在ECS服务器创建SQLite数据库文件，用于缓存当日爬虫数据与选题建议

## 分发路径
### 内部分发（系统组件间）
扣子工作流 → 极致了数据平台 → Streamlit后台 → 扣子工作流推送节点

### 用户触达路径
1. **首次触达**：用户通过自行部署的Streamlit后台链接完成初始化配置
2. **日常触达**：每日预设时间通过飞书/微信公众号自动推送选题清单，用户无需主动操作
3. **异常触达**：当爬虫失败、推送延迟时，系统通过飞书机器人发送异常通知

## 环境配置
### 开发环境
- 本地Python环境：用于开发与测试数据处理脚本、Streamlit界面
- 扣子工作流测试环境：用于验证爬虫切换逻辑、工作流触发规则

### 生产环境
- 扣子工作流生产环境：运行核心自动化流程
- 阿里云ECS生产环境：部署后台仪表盘
- 极致了数据平台生产环境：存储核心业务数据

## 监控与运维
1. **扣子工作流监控**：利用平台内置的工作流日志功能，实时查看爬虫、数据处理、推送各节点的状态，异常时触发邮件告警
2. **服务器监控**：通过阿里云云监控查看ECS服务器的CPU、内存使用率，设置阈值告警（如CPU使用率超过80%时告警）
3. **数据质量监控**：每日自动生成数据质量报告，包含爬虫成功率、数据完整性、选题生成数量等指标，发送至用户邮箱
4. **日志管理**：将爬虫日志、数据处理日志存储在阿里云SLS日志服务，保留30天用于问题排查